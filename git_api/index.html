<html>
<head>
	<title>Git API Exmaple</title>

	<!-- Formatting -->

	<style>
		#results li.pass { color: green; }
		#results li.fail { color: red; }
	</style>
	
</head>
<body>

	<div id="myapp">
	
		<header>
			<h1>My App</h1>
		</header>

		<div id="test1">
			Menu:
			<a href="#route1">lists gists</a>
			<a href="#route2">#route2</a>
			<a href="#/route3/i_love/this">#route3</a>
			<a href="#route4">#route4</a>
		</div>

		<section id="blog">
			<ul id="gists">

			</ul>
		</section>
		
		<footer>
			2012 by Gizur AB
		</footer>
	  
	</div>

	
	<ul id="results"></ul>


	<!-- Scripts at the end for quicker loading -->

	<script src="lib/jquery.min.js"></script>

	<!-- My unit test and logging functions -->
	<script src="lib/basic.js"></script>

	<!-- Used for the views -->
	<script src="lib/underscore-min.js"></script>

	<!-- Used for routing -->
	<script src="lib/signals.js"></script>
	<script src="lib/crossroads.min.js"></script>
	<script src="lib/hasher.min.js"></script>

	<script>
	window.onload = function(){

		// Cache the template function 
		var tmpl = _.template($('#item-template').html());

		// Register ajax error handler
		$.ajaxSetup({
	        error: function (x, status, error) {
				log('Got an error: ' + status + 'Error details:' + error);
	        },
			statusCode: {
				403: function() {								// Both this and the error function below will be called for 4XX
					log('Got an 403, forbidden...');
				},
				404: function() {
					log('Got an 404...');
				},
				302: function() {
					log('Got a re-direct, 302...');
				}
			}
		});

		// Register my own window error handler
		window.onerror = function(errorMsg, url, lineNumber) {
			log('Got window.onerror: ' + errorMsg + ' for URL: ' + url + ' on line number: ' + lineNumber);
		};
					
		// setup crossroads, using the global object. 
		// It is also possible to have several independent Routers
		crossroads.addRoute('route1', function() { 
			log('logging static route1...');

			// Play around with REST
			$.ajax({
				url:      'https://api.github.com/users/colmsjo/gists',
				dataType: 'jsonp',
				type:     'GET',														// What's supported depends on the browser
				//headers: {'Access-Control-Allow-Origin':'*'},
				success: function(data) {

					$.each(data.data, function(index, val) {

						var li = document.createElement("li");
						//li.className = value ? "pass" : "fail";
						li.appendChild( document.createTextNode( val.description +":"+ val.html_url) );

						log( $('#gists') );

						document.getElementById("gists").appendChild( li );;
					});

				}
			});
		});
		
		
		// default listener, log all routes that has been matched
		crossroads.routed.add(console.log, console); 
		
		// Also log routes that did not match anything (useful for debugging)
		crossroads.bypassed.add(function(request){
			log("A route that wasn't matched:"+request); 
		});
		
		//setup hasher
		function parseHash(newHash, oldHash){
			crossroads.parse(newHash); 
		}
		
		hasher.initialized.add(parseHash); 			// parse initial hash 
		hasher.changed.add(parseHash); 				// parse hash changes 
		hasher.init(); 								// start listening for history change
		
		//update URL fragment generating new history record 
		hasher.setHash('route1');

	};
	</script>


	<!-- Templates -->
	<script type="text/template" id="item-template">
	  <div>
	    <br/><label><%= title %></label><br/><br/>
	  </div>
	</script>


</body>
</html>