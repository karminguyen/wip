<!DOCTYPE html>  <html> <head>   <title>git_api.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               git_api.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <hr />

<p>2012-10-07, Jonas Colmsj√∂</p>

<p>Copyright Gizur AB</p>

<p>Playing aroung the the Git REST API and Backbone.js at the same time</p>

<p>Documentation is created using docco (installed with npm). Put comments on separate
rows. Markdown can also be used for nice formatting. </p>

<hr />             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Load the application once the DOM is ready</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>Gists Model</h2>

<p>Calling https://api.github.com/users/colmsjo/gists will give JSON looking like this. Each object in teh array is 
parsed as one Gist by Backbone.Collection</p>

<p><code>
[
  {
    "comments": 1,
    "created_at": "2012-09-09T12:50:41Z",
    "git_pull_url": "git://gist.github.com/3684138.git",
    "git_push_url": "git@gist.github.com:3684138.git",
    "updated_at": "2012-09-09T12:50:41Z",
    "public": true,
    "html_url": "https://gist.github.com/3684138",
    "user": {
      "gravatar_id": "131fe77c7762c5421d1023c73cb61076",
      "avatar_url": "https://secure.gravatar.com/avatar/131fe77c7762c5421d1023c73cb61076?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png",
      "login": "colmsjo",
      "url": "https://api.github.com/users/colmsjo",
      "urls": {
        "self": "https://api.github.com/users/colmsjo"
      },
      "id": 1313294
    },
    "url": "https://api.github.com/gists/3684138",
    "id": "3684138",
    "description": "My first test Gist",
    "files": {
      "test1.md": {
        "type": "text/plain",
        "filename": "test1.md",
        "raw_url": "https://gist.github.com/raw/3684138/80430a520c23c93825120c948d82059a7fd58fa1/test1.md",
        "size": 60,
        "language": "Markdown"
      }
    }
  }
]
</code></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>extend Backbone</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">Gist</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>

  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h2>Gist Collection</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">GistList</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Reference to this collection's model.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">model</span><span class="o">:</span> <span class="nx">Gist</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>REST function to use</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;https://api.github.com/users/colmsjo/gists&#39;</span>

  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>create one global instance of the <strong>GistView</strong></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">View</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GistView</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Create our global collection of <strong>Gists</strong>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">Gists</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GistList</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h2>Gist Item View</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>The DOM element for a Gist item...</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">GistView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>... is a list tag.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">tagName</span><span class="o">:</span>  <span class="s2">&quot;li&quot;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Cache the template function for a single item.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">template</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#item-template&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">()),</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>The DOM events specific to an item
Format:  "event DOM-element : function"
Example: "keypress .edit"  : "updateOnEnter",</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Re-render the titles of the Gist item.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">gists</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/*      this.$el.html(this.template(this.model.toJSON()));</span>
<span class="cm">      this.$el.toggleClass(&#39;done&#39;, this.model.get(&#39;done&#39;));</span>
<span class="cm">      this.input = this.$(&#39;.edit&#39;);   </span>
<span class="cm">*/</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>

    <span class="p">},</span>

  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h2>Setup error handling</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Register ajax error handler</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">ajaxSetup</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Log whenever an error occurs</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Got an error: &#39;</span> <span class="o">+</span> <span class="nx">status</span> <span class="o">+</span> <span class="s1">&#39;Error details:&#39;</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>what to do for different error codes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">statusCode</span><span class="o">:</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Both this and the error function below will be called for 4XX</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="mi">403</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Got an 403, forbidden...&#39;</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="mi">404</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Got an 404...&#39;</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="mi">302</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Got a re-direct, 302...&#39;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Register my own window error handler</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nb">window</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">errorMsg</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">lineNumber</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Got window.onerror: &#39;</span> <span class="o">+</span> <span class="nx">errorMsg</span> <span class="o">+</span> <span class="s1">&#39; for URL: &#39;</span> <span class="o">+</span> <span class="nx">url</span> <span class="o">+</span> <span class="s1">&#39; on line number: &#39;</span> <span class="o">+</span> <span class="nx">lineNumber</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h2>Setup crossroads</h2>             </td>             <td class="code">               <div class="highlight"><pre>        </pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>setup crossroads, using the global object. 
It is also possible to have several independent Routers</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">crossroads</span><span class="p">.</span><span class="nx">addRoute</span><span class="p">(</span><span class="s1">&#39;route1&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> 
    <span class="nx">log</span><span class="p">(</span><span class="s1">&#39;logging static route1...&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Fetch the list of gists</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Gists</span><span class="p">.</span><span class="nx">fetch</span><span class="p">({</span> 
      <span class="nx">dataType</span><span class="o">:</span> <span class="s1">&#39;jsonp&#39;</span><span class="p">,</span>
      <span class="nx">type</span><span class="o">:</span>     <span class="s1">&#39;GET&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>currently not used, headers: {'Access-Control-Allow-Origin':'*'},</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Render the view</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">View</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">Gists</span><span class="p">.</span><span class="nx">model</span><span class="p">);</span>

  <span class="p">});</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>default listener, log all routes that has been matched</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">crossroads</span><span class="p">.</span><span class="nx">routed</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">,</span> <span class="nx">console</span><span class="p">);</span> 
  </pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Also log routes that did not match anything (useful for debugging)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">crossroads</span><span class="p">.</span><span class="nx">bypassed</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">){</span>
    <span class="nx">log</span><span class="p">(</span><span class="s2">&quot;A route that wasn&#39;t matched:&quot;</span><span class="o">+</span><span class="nx">request</span><span class="p">);</span> 
  <span class="p">});</span>
  </pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <h2>setup hasher - is used by crossroads</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">parseHash</span><span class="p">(</span><span class="nx">newHash</span><span class="p">,</span> <span class="nx">oldHash</span><span class="p">){</span>
    <span class="nx">crossroads</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">newHash</span><span class="p">);</span> 
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>parse initial hash </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">hasher</span><span class="p">.</span><span class="nx">initialized</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">parseHash</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>parse hash changes         </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">hasher</span><span class="p">.</span><span class="nx">changed</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">parseHash</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>start listening for history change</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">hasher</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span> 
  </pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>update URL fragment generating new history record </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">hasher</span><span class="p">.</span><span class="nx">setHash</span><span class="p">(</span><span class="s1">&#39;route1&#39;</span><span class="p">);</span>


<span class="p">};</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 